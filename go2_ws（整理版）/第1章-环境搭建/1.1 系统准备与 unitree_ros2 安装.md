# 1.1 系统准备与 unitree_ros2 安装

## 学习目标
- 了解 Unitree Go2 机器狗开发所需的系统环境
- 掌握 unitree_ros2 软件包的安装流程
- 理解 CycloneDDS 通信中间件的作用和配置方法

---

## 一、系统要求

### 1.1 硬件要求
- 计算机：配置合理的笔记本或台式机
- 网络：需要有线网口（用于连接 Go2 机器狗）
- 存储：至少 20GB 可用空间

### 1.2 软件要求
- **操作系统**：Ubuntu 22.04 LTS
- **ROS2 版本**：Humble Hawksbill

双系统安装可参考B站视频：【Windows 10 和 Ubuntu 双系统的安装和卸载】
https://www.bilibili.com/video/BV1554y1n7zv?vd_source=e826416e2d1ee7e81b4a504563d2d78e


> **说明**：ROS2 有多个版本（如 Foxy、Humble 等），本教程使用最新的 Humble 版本。如果你看到其他资料中使用 Foxy，只需将命令中的 `foxy` 替换为 `humble` 即可。

---

## 二、安装 ROS2 Humble（前置步骤）

如果你的系统还没有安装 ROS2 Humble，请先执行以下步骤：

### 2.1 设置软件源
```bash
# 添加 ROS2 软件源
sudo apt update && sudo apt install locales
sudo locale-gen en_US en_US.UTF-8
sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8
export LANG=en_US.UTF-8

# 添加 ROS2 APT 仓库
sudo apt install software-properties-common
sudo add-apt-repository universe
sudo apt update && sudo apt install curl -y
sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(. /etc/os-release && echo $UBUNTU_CODENAME) main" | sudo tee /etc/apt/sources.list.d/ros2.list > /dev/null
```

### 2.2 安装 ROS2 Humble
```bash
# 更新软件包列表
sudo apt update

# 安装 ROS2 Humble 桌面完整版
sudo apt install ros-humble-desktop -y

# 安装开发工具
sudo apt install ros-dev-tools -y
```

### 2.3 验证安装
```bash
# 加载 ROS2 环境
source /opt/ros/humble/setup.bash

# 测试 ROS2 是否安装成功
ros2 --help
```

如果看到 ROS2 的帮助信息，说明安装成功。

---

## 三、克隆 unitree_ros2 仓库

### 3.1 打开终端并克隆仓库
```bash
# 进入家目录
cd ~

# 克隆 unitree_ros2 仓库
git clone https://github.com/unitreerobotics/unitree_ros2
```

> **说明**：这个仓库包含了 Unitree Go2 机器狗在 ROS2 环境下的所有必要功能包和示例代码。

### 3.2 查看仓库结构
```bash
# 进入仓库目录
cd ~/unitree_ros2

# 查看目录结构
ls -l
```

你应该能看到类似以下的目录结构：
- `cyclonedds_ws/` - CycloneDDS 工作空间
- `example/` - 示例程序
- 其他配置文件

---

## 四、安装依赖包

### 4.1 安装 CycloneDDS 相关依赖
```bash
# 安装 CycloneDDS C++ 支持
sudo apt install ros-humble-rmw-cyclonedds-cpp

# 安装 DDS IDL 生成器
sudo apt install ros-humble-rosidl-generator-dds-idl
```

> **什么是 CycloneDDS？**
> DDS (Data Distribution Service) 是 ROS2 的底层通信中间件。Unitree Go2 使用的是 CycloneDDS 0.10.2 版本。为了确保通信兼容，我们需要编译特定版本的 CycloneDDS。

---

## 五、编译 CycloneDDS

### 5.1 重要准备工作：清理环境变量

**⚠️ 注意**：编译 CycloneDDS 之前，必须确保终端中**没有加载** ROS2 环境变量，否则会导致编译失败。

#### 检查 ~/.bashrc 文件
```bash
# 使用文本编辑器打开 .bashrc 文件
sudo apt install gedit -y
gedit ~/.bashrc
```

在打开的文件中，查找是否有类似以下的行：
```bash
source /opt/ros/humble/setup.bash
```

如果有，请在行首添加 `#` 号将其注释掉：
```bash
# source /opt/ros/humble/setup.bash
```

保存文件并关闭编辑器。

#### 重新加载配置
```bash
# 使配置生效
source ~/.bashrc
```

### 5.2 编译 CycloneDDS

**重新打开一个新的终端**（确保没有 ROS2 环境变量），然后执行：

```bash
# 进入 CycloneDDS 工作空间的 src 目录
cd ~/unitree_ros2/cyclonedds_ws/src

# 克隆 CycloneDDS 相关仓库（Humble 版本）
git clone https://github.com/ros2/rmw_cyclonedds -b humble
git clone https://github.com/eclipse-cyclonedds/cyclonedds -b releases/0.10.x

# 返回工作空间根目录
cd ..

# 编译 CycloneDDS
colcon build --packages-select cyclonedds
```

> **编译说明**：
> - `colcon build` 是 ROS2 的编译工具
> - `--packages-select cyclonedds` 表示只编译 cyclonedds 包
> - 编译过程可能需要几分钟时间，请耐心等待

### 5.3 验证编译结果
编译完成后，你应该能看到类似以下的输出：
```
Summary: 1 package finished [编译时间]
```

如果没有错误信息，说明编译成功。

---

## 六、编译 unitree_go 和 unitree_api 功能包

### 6.1 加载 ROS2 环境变量

编译 Go2 功能包时，需要 ROS2 的依赖，因此要先加载 ROS2 环境：

```bash
# 加载 ROS2 Humble 环境
source /opt/ros/humble/setup.bash
```

### 6.2 编译所有功能包

```bash
# 进入 unitree_ros2 根目录
cd ~/unitree_ros2

# 编译工作空间下的所有功能包
colcon build
```

> **编译说明**：
> - 首次编译可能需要 5-10 分钟
> - 如果出现错误，请检查是否正确加载了 ROS2 环境
> - 编译成功后会生成 `install/` 目录

### 6.3 验证编译结果
```bash
# 查看 install 目录
ls install/
```

你应该能看到 `unitree_go`、`unitree_api` 等功能包。

---

## 七、编译常见问题解决

### 问题 1：编译 CycloneDDS 时报错
**原因**：可能是 ROS2 环境变量没有清理干净。
**解决**：
1. 关闭所有终端
2. 重新打开一个新终端
3. 确认 `echo $ROS_DISTRO` 输出为空
4. 重新执行编译命令

### 问题 2：编译 unitree_go 时提示找不到依赖
**原因**：ROS2 环境没有正确加载。
**解决**：
```bash
source /opt/ros/humble/setup.bash
colcon build
```

### 问题 3：权限不足
**原因**：某些文件需要管理员权限。
**解决**：
```bash
sudo chown -R $USER:$USER ~/unitree_ros2
```

---

## 八、小结

本节内容我们完成了：
✅ Ubuntu 22.04 和 ROS2 Humble 的准备
✅ unitree_ros2 仓库的克隆
✅ CycloneDDS 通信中间件的编译
✅ unitree_go 和 unitree_api 功能包的编译

**下一步**：我们将学习如何配置网络，使计算机能够与 Go2 机器狗进行通信。

---

## 拓展阅读

- [ROS2 官方文档](https://docs.ros.org/en/humble/index.html)
- [CycloneDDS 介绍](https://docs.ros.org/en/humble/Concepts/About-Different-Middleware-Vendors.html)
- [Unitree Go2 官方文档](https://support.unitree.com/)
